events {
    worker_connections   2000;
}	
	
http {

	server {
	    listen 80;
	    server_name _;
	    return 301 https://$host$request_uri;
	}

	server {
	    listen 80;
	    server_name rivendell.hjedi.net;
            location /stats {
	        stub_status;
	    }
	}

	# HTTPS (Port 443)
	server {
	    listen 443 ssl;
	    
	    server_name app.hjedi.net;
	 
            # Common SSL Settings
            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
            ssl_session_cache shared:SSL:10m;
            ssl_session_timeout 10m;
            ssl_certificate /etc/nginx/certs/fullchain-local.pem;
            ssl_certificate_key /etc/nginx/certs/privkey-local.pem;

            location / {
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_pass http://dmtools_ui_backend;
            }
        }
	
	server {
	    listen 443 ssl;
	    
	    server_name it.hjedi.net;
	 
            # Common SSL Settings
            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
            ssl_session_cache shared:SSL:10m;
            ssl_session_timeout 10m;
            ssl_certificate /etc/nginx/certs/fullchain-local.pem;
            ssl_certificate_key /etc/nginx/certs/privkey-local.pem;

            location / {
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_pass http://it_tools_backend;
            }
        }
	
	server {
	    listen 443 ssl;
	    
	    server_name n8n.hjedi.net;
	 
            # Common SSL Settings
            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
            ssl_session_cache shared:SSL:10m;
            ssl_session_timeout 10m;
            ssl_certificate /etc/nginx/certs/fullchain-local.pem;
            ssl_certificate_key /etc/nginx/certs/privkey-local.pem;

            location / {
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;

		proxy_set_header Upgrade $http_upgrade;
	        proxy_set_header Connection "Upgrade";
		proxy_pass http://n8n_tools_backend;
                
		#proxy_pass http://foundry_backend;
		#proxy_pass http://192.168.4.50:5678;
		#proxy_http_version 1.1;
		#proxy_set_header Connection "upgrade";
		#proxy_set_header Upgrade $http_upgrade;
		#proxy_set_header X-Real-IP $remote_addr;
		#proxy_set_header Host $host;
		#proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		#proxy_pass http://n8n_tools_backend;
	    }
	}

	server {
	    listen 443 ssl;
	    
	    server_name rivendell-admin.hjedi.net;
	 
            # Common SSL Settings
            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
            ssl_session_cache shared:SSL:10m;
            ssl_session_timeout 10m;
            ssl_certificate /etc/nginx/certs/fullchain-local.pem;
            ssl_certificate_key /etc/nginx/certs/privkey-local.pem;

            location / {
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_pass http://portainer_backend;
            }
        }
	
	server {
	    listen 443 ssl;
	    
	    server_name roller.hjedi.net;
	 
            # Common SSL Settings
            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
            ssl_session_cache shared:SSL:10m;
            ssl_session_timeout 10m;
            ssl_certificate /etc/nginx/certs/fullchain-local.pem;
            ssl_certificate_key /etc/nginx/certs/privkey-local.pem;

            location / {
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_pass http://dice_roller_backend;
            }
        }
	
	server {
	    listen 443 ssl;
	    
	    server_name registryui.hjedi.net;
	 
            # Common SSL Settings
            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
            ssl_session_cache shared:SSL:10m;
            ssl_session_timeout 10m;
            ssl_certificate /etc/nginx/certs/fullchain-local.pem;
            ssl_certificate_key /etc/nginx/certs/privkey-local.pem;

            location / {
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_pass http://192.168.4.50:5080;
            }
        }
	
	server {
	    listen 443 ssl;
	    
	    server_name registry.hjedi.net;
	 
            # Common SSL Settings
            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
            ssl_session_cache shared:SSL:10m;
            ssl_session_timeout 10m;
            ssl_certificate /etc/nginx/certs/fullchain-local.pem;
            ssl_certificate_key /etc/nginx/certs/privkey-local.pem;

            location / {
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_pass http://192.168.4.50:5001;
            }
        }
	
	
	server {
	    listen 443 ssl;
	    
	    server_name dmtools.hjedi.net;
	 
            # Common SSL Settings
            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
            ssl_session_cache shared:SSL:10m;
            ssl_session_timeout 10m;
            ssl_certificate /etc/nginx/certs/fullchain-local.pem;
            ssl_certificate_key /etc/nginx/certs/privkey-local.pem;

            location / {
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_pass http://dmtools_backend;
            }
        }
	
	server {
	    listen 443 ssl;
	    
	    server_name foundryu.hjedi.net;
	 
            # Common SSL Settings
            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
            ssl_session_cache shared:SSL:10m;
            ssl_session_timeout 10m;
            ssl_certificate /etc/nginx/certs/fullchain-local.pem;
            ssl_certificate_key /etc/nginx/certs/privkey-local.pem;

	    client_max_body_size 300M;


            # DM Tools (foundryu.hjedi.net)
            location / {
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;
	
		proxy_set_header Upgrade $http_upgrade;
	        proxy_set_header Connection "Upgrade";
                proxy_pass http://192.168.4.50:30001;
            }
        }
	
	server {
	    listen 443 ssl;
	    
	    server_name foundrydh.hjedi.net;
	 
            # Common SSL Settings
            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
            ssl_session_cache shared:SSL:10m;
            ssl_session_timeout 10m;
            ssl_certificate /etc/nginx/certs/fullchain-local.pem;
            ssl_certificate_key /etc/nginx/certs/privkey-local.pem;

	    client_max_body_size 300M;

            location / {
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;
	
		proxy_set_header Upgrade $http_upgrade;
	        proxy_set_header Connection "Upgrade";
                proxy_pass http://192.168.4.50:30001;
	    }
	}

	server {
	    listen 443 ssl;
	    
	    server_name foundry.hjedi.net;
	 
            # Common SSL Settings
            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
            ssl_session_cache shared:SSL:10m;
            ssl_session_timeout 10m;
            ssl_certificate /etc/nginx/certs/fullchain-local.pem;
            ssl_certificate_key /etc/nginx/certs/privkey-local.pem;

	    client_max_body_size 300M;

            location / {
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;

		proxy_set_header Upgrade $http_upgrade;
	        proxy_set_header Connection "Upgrade";
                proxy_pass http://foundry_backend;
            }
        }
	
	server {
	    listen 443 ssl;
	    
	    server_name foundryguid.hjedi.net;
	 
            # Common SSL Settings
            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
            ssl_session_cache shared:SSL:10m;
            ssl_session_timeout 10m;
            ssl_certificate /etc/nginx/certs/fullchain-local.pem;
            ssl_certificate_key /etc/nginx/certs/privkey-local.pem;

	    client_max_body_size 300M;

            location / {
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;

		proxy_set_header Upgrade $http_upgrade;
	        proxy_set_header Connection "Upgrade";
                proxy_pass http://foundryguid_backend;
            }
        }
    
	server {
	    listen 443 ssl;
	    
	    server_name metrics.hjedi.net;
	 
            # Common SSL Settings
            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
            ssl_session_cache shared:SSL:10m;
            ssl_session_timeout 10m;
            ssl_certificate /etc/nginx/certs/fullchain-local.pem;
            ssl_certificate_key /etc/nginx/certs/privkey-local.pem;

	    client_max_body_size 300M;

            location / {
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;

		proxy_set_header Upgrade $http_upgrade;
	        proxy_set_header Connection "Upgrade";
                proxy_pass http://metrics_backend;
            }
        }
    
	server {
	    listen 443 ssl;
	    
	    server_name windmill.hjedi.net;
	 
            # Common SSL Settings
            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
            ssl_session_cache shared:SSL:10m;
            ssl_session_timeout 10m;
            ssl_certificate /etc/nginx/certs/fullchain-local.pem;
            ssl_certificate_key /etc/nginx/certs/privkey-local.pem;

	    client_max_body_size 300M;

            location / {
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;

		proxy_set_header Upgrade $http_upgrade;
	        proxy_set_header Connection "Upgrade";
                proxy_pass http://windmill_backend;
            }
        }



    # Backend Definitions
    upstream dmtools_ui_backend {
        server 192.168.4.41:5580 max_fails=5 fail_timeout=30s;
        server 192.168.4.42:5580 max_fails=5 fail_timeout=30s;
        server 192.168.4.43:5580 max_fails=5 fail_timeout=30s;
    }

    upstream dice_roller_backend {
        server 192.168.4.41:5500 max_fails=5 fail_timeout=30s;
        server 192.168.4.42:5500 max_fails=5 fail_timeout=30s;
        server 192.168.4.43:5500 max_fails=5 fail_timeout=30s;
    }

    upstream dmtools_backend {
        server 192.168.4.41:6400 max_fails=5 fail_timeout=30s;
        server 192.168.4.42:6400 max_fails=5 fail_timeout=30s;
        server 192.168.4.43:6400 max_fails=5 fail_timeout=30s;
    }

    upstream foundry_backend {
        server 192.168.4.50:30000 max_fails=5 fail_timeout=30s;
    }

    upstream foundryu_backend {
        server 192.168.4.50:30001 max_fails=5 fail_timeout=30s;
    }

    upstream foundryguid_backend {
        server 192.168.4.50:30000 max_fails=5 fail_timeout=30s;
    }

    upstream it_tools_backend {
        server 192.168.4.41:7800 max_fails=5 fail_timeout=30s;
        server 192.168.4.42:7800 max_fails=5 fail_timeout=30s;
        server 192.168.4.43:7800 max_fails=5 fail_timeout=30s;
    }

    upstream n8n_tools_backend {
        server 192.168.4.50:5678 max_fails=5 fail_timeout=30s;
    }

    upstream portainer_backend {
        server 192.168.4.50:9000 max_fails=5 fail_timeout=30s;
    }
    
    upstream metrics_backend {
        server 192.168.4.50:3000 max_fails=5 fail_timeout=30s;
    }
    
    upstream windmill_backend {
        server 192.168.4.50:9200 max_fails=5 fail_timeout=30s;
    }
}
